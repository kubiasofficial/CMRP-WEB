<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>CMRP | Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #bc13fe; --secondary: #00f2ff; }
        body { margin: 20px; font-family: 'Rajdhani', sans-serif; background: #0a0a0a; color: white; }
        .card { background: #151515; border: 1px solid #333; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .q-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px; margin-top: 10px; border-left: 3px solid var(--primary); }
        button { padding: 10px 20px; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; font-family: 'Rajdhani'; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è WL SPR√ÅVA</h1>
    <div id="list"></div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, deleteDoc, updateDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBpP1B-Gob2GkgQ761nyLTBhCtZBKOCvvs", authDomain: "cmrp-system.firebaseapp.com", projectId: "cmrp-system", storageBucket: "cmrp-system.firebasestorage.app", appId: "1:264321137651:web:295e93bd12e7f8b80fb086" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        onSnapshot(collection(db, "zadosti"), (snap) => {
            const list = document.getElementById('list'); list.innerHTML = "";
            snap.forEach(s => {
                const d = s.data(); const div = document.createElement('div'); div.className="card";
                div.innerHTML = `
                <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                    <img src="${d.avatar}" style="width:50px; border-radius:50%; border:2px solid var(--primary);">
                    <div><strong>${d.discordTag}</strong> (Pokus: ${d.pokus})<br><small>${d.discordId}</small></div>
                </div>
                <div class="q-box"><strong>Steam HEX:</strong> ${d.steamHex}</div>
                <div class="q-box"><strong>Lore:</strong> ${d.lore}</div>
                <div style="margin-top:15px; display:flex; gap:10px;">
                    <input type="text" id="r-${s.id}" placeholder="D≈Øvod zam√≠tnut√≠ / Pozn√°mka..." style="flex-grow:1; background:#000; color:white; border:1px solid #444; padding:10px;">
                    <button style="background:#22ff22; color:black;" onclick="process('${s.id}', '${d.discordId}', 'schv√°leno', ${JSON.stringify(d).replace(/"/g, '&quot;')})">SCHV√ÅLIT</button>
                    <button style="background:#ff2222; color:white;" onclick="process('${s.id}', '${d.discordId}', 'zam√≠tnuto', ${JSON.stringify(d).replace(/"/g, '&quot;')})">ZAM√çTNOUT</button>
                </div>`;
                list.appendChild(div);
            });
        });

        window.process = async (id, uid, status, d) => {
            const reason = document.getElementById(`r-${id}`).value;
            const admin = JSON.parse(localStorage.getItem('user'));
            if(status==='zam√≠tnuto' && !reason) return alert("Napi≈° d≈Øvod!");

            await updateDoc(doc(db, "users", uid), { wlStatus: status });
            await addDoc(collection(db, "history"), { uid, status, reason: reason || "Schv√°leno", admin: admin.username, date: serverTimestamp() });
            await deleteDoc(doc(db, "zadosti", id));

            const webhook = status === 'schv√°leno' ? "https://discord.com/api/webhooks/1476489493056979004/Q2y0Kl0wpzyanQJWPd3OKuP_ZKw9lkjSQOohONKhAZpqb4XzCEh3TNOM-avN7bFCLaBP" : "https://discord.com/api/webhooks/1476489397254885438/wsZXiU-fudd36_hDir8aSFNSdKUeJZYADJoVJMS99E0m1w2CbioG0KZHRlpdBF7krMkg";
            
            await fetch(webhook, {
                method: "POST", headers: {"Content-Type":"application/json"},
                body: JSON.stringify({ embeds: [{
                    title: status === 'schv√°leno' ? "‚úÖ Schv√°len√° ≈æ√°dost" : "‚ùå Zam√≠tnut√° ≈æ√°dost",
                    color: status === 'schv√°leno' ? 3066993 : 15158332,
                    thumbnail: {url: d.avatar},
                    fields: [
                        {name: "Hr√°ƒç", value: d.discordTag, inline: true},
                        {name: "Discord ID", value: uid, inline: true},
                        {name: "Pokus", value: d.pokus.toString() + ".", inline: true},
                        {name: status === 'schv√°leno' ? "Pozn√°mka" : "D≈Øvod zam√≠tnut√≠", value: reason || "Bez pozn√°mky"},
                        {name: "WL Adder", value: admin.username}
                    ], timestamp: new Date()
                }]})
            });
            alert("Vy≈ô√≠zeno!");
        };
    </script>
</body>
</html>