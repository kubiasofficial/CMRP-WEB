<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMRP | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #bc13fe; --secondary: #00f2ff; --bg: #0a0a0a; }
        body, html { 
            margin: 0; padding: 0; min-height: 100vh; font-family: 'Rajdhani', sans-serif; color: white;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.8)), url('pozadicko.jpg') no-repeat center center fixed; background-size: cover;
            display: flex; align-items: center; justify-content: center;
        }
        .container { width: 100%; max-width: 1000px; padding: 20px; text-align: center; }
        .user-info img { width: 110px; height: 110px; border-radius: 50%; border: 4px solid var(--primary); box-shadow: 0 0 20px var(--primary); margin-bottom: 15px; }
        .user-info h1 { font-size: 3.5rem; margin: 0 0 40px 0; letter-spacing: 5px; text-transform: uppercase; }
        .card-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .card { 
            background: rgba(15,15,15,0.9); border: 1px solid #333; border-radius: 20px; padding: 30px; width: 280px; 
            transition: 0.3s; cursor: pointer; border-bottom: 4px solid transparent;
        }
        .card:hover { border-color: var(--primary); transform: translateY(-5px); background: rgba(25,25,25,0.95); }
        .card.p-card { border-bottom-color: var(--secondary); }
        .card.s-card { border-bottom-color: #ffcc00; }
        .card.a-card { border-bottom-color: var(--primary); }
        .card img { width: 40px; margin-bottom: 15px; filter: invert(1); }
        .card h3 { margin: 10px 0; font-size: 1.5rem; text-transform: uppercase; }
        .status-none { color: #ffcc00; font-weight: bold; display: block; margin: 10px 0; }
        .logout-btn { margin-top: 40px; background: rgba(255,255,255,0.05); border: 1px solid #444; color: white; padding: 10px 25px; border-radius: 5px; cursor: pointer; font-family: 'Rajdhani'; }
        
        /* Modal Style */
        #profile-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: #111; padding: 40px; border-radius: 20px; border: 1px solid var(--primary); text-align: left; min-width: 300px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="user-info">
            <img id="user-avatar" src="">
            <h1 id="user-name">NAČÍTÁNÍ...</h1>
        </div>
        <div class="card-grid">
            <div class="card p-card" onclick="location.href='prihlaska.html'">
                <img src="https://cdn-icons-png.flaticon.com/512/2991/2991108.png">
                <h3>Přihláška</h3>
                <p>Odeslat novou žádost o WL</p>
            </div>
            <div class="card s-card" onclick="openModal()">
                <img src="https://cdn-icons-png.flaticon.com/512/1271/1271380.png">
                <h3>Stav WL</h3>
                <span id="wl-status-text" class="status-none">NONE</span>
                <p style="font-size: 0.8rem; color: var(--secondary);">KLIKNI PRO DETAIL</p>
            </div>
            <div class="card a-card" onclick="location.href='admin.html'">
                <img src="https://cdn-icons-png.flaticon.com/512/2206/2206248.png">
                <h3>WL Adder</h3>
                <p>Administrace žádostí</p>
            </div>
        </div>
        <button class="logout-btn" onclick="logout()">ODHLÁSIT SE</button>
    </div>

    <div id="profile-modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 style="color:var(--primary); margin-top:0;">DETAIL PROFILU</h2>
            <p><strong>Discord ID:</strong> <span id="m-id"></span></p>
            <p><strong>Stav:</strong> <span id="m-status"></span></p>
            <p><strong>Pokusy:</strong> 3 / 3</p>
            <button class="logout-btn" onclick="closeModal()">ZAVŘÍT</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBpP1B-Gob2GkgQ761nyLTBhCtZBKOCvvs", authDomain: "cmrp-system.firebaseapp.com", projectId: "cmrp-system", storageBucket: "cmrp-system.firebasestorage.app", appId: "1:264321137651:web:295e93bd12e7f8b80fb086" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Simulace přihlášení (zde by byla tvoje Discord logika)
        const user = JSON.parse(localStorage.getItem('user'));
        if(!user) location.href = 'login.html'; // Předpokládám, že máš login.html

        document.getElementById('user-name').innerText = user.username;
        document.getElementById('user-avatar').src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;

        const userDoc = await getDoc(doc(db, "users", user.id));
        const status = userDoc.exists() ? userDoc.data().wlStatus : "NONE";
        document.getElementById('wl-status-text').innerText = status.toUpperCase();

        window.openModal = () => {
            document.getElementById('m-id').innerText = user.id;
            document.getElementById('m-status').innerText = status.toUpperCase();
            document.getElementById('profile-modal').style.display = 'flex';
        }
        window.closeModal = () => document.getElementById('profile-modal').style.display = 'none';
        window.logout = () => { localStorage.clear(); location.reload(); };
    </script>
</body>
</html>